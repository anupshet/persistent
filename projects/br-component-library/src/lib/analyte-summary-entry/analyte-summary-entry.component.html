<!-- Â© 2023 Bio-Rad Laboratories, Inc. All Rights Reserved. -->
<div class="heading-ctn mat-typography mt-10 ml-10"
  *ngIf="!isSingleEntry || isSingleEditMode || isProductMasterLotExpired">
  <div><span class="mb-0" *ngIf="!isSingleEntry || isSingleEditMode">{{ analyteEntry?.analyteName }}</span></div>
  <div class="heading-spacer" *ngIf="!isSingleEntry || isSingleEditMode"></div>
  <div *ngIf="isProductMasterLotExpired" class="product-lot-expiration-error">{{ translationLabels.expired }}</div>
</div>

<div class="wrapper mat-typography analyte-summary-entry-component"
  [ngClass]="{'modal-single-summary': isSingleEditMode }" (mouseenter)="mouseEnter(true)"
  (mouseleave)="mouseEnter(false)">

  <div class="flex-ctn mat-typography">

    <div class="mr-20 fix-top-margin" *ngIf="isSingleEntry">
      <br-date-time-picker [translationLabels]="translationLabels" [displayInline]="false" [canSelectDate]="!isDisabled"
        [canSelectTime]="displayTime && !isDisabled" (dateSelected)="updateAnalyteDate($event)" [currentLanguage]="currentLanguage"
        [selectedDateTime]="selectedDate" [availableDateTo]="availableDateTo" [availableDateFrom]="availableDateFrom"
        [hideLabel]="true" [canInputDate]="false" [timeZone]="timeZone" [isEditMode]="isEditMode" [shortDate]="true">
      </br-date-time-picker>
    </div>

    <div class="item-2">
      <table mat-table [dataSource]="labels">
        <ng-container [matColumnDef]="columnsToDisplay[0]">
          <td mat-cell *matCellDef="let row; let rowIndex=index;">
            <span [ngClass]="{'br-uppercase': rowIndex === 1, 'br-capitalize': rowIndex !== 1}">{{ labels[rowIndex]
              }}</span>
          </td>
        </ng-container>

        <ng-container *ngFor="let col of (columnsToDisplay | slice:1); let colIndex=index;" [matColumnDef]="col">

          <td mat-cell *matCellDef="let row; let rowIndex=index;" [ngClass]="{'ml-14': colIndex != 0}"
            class="data-entry-input-container">
            <span *ngIf="rowIndex === 0" class="level-label level-{{col}}">{{col}}</span>
            <div *ngIf="arrIndexFromLevelSummary[colIndex]!== null; else emptyTemplate;">
              <div [ngSwitch]="rowIndex">
                <span>
                  <mat-form-field *ngSwitchCase="0" class="small">
                    <input matInput #dataInputEntry="matInput" maxlength="16" autocomplete="off"
                      [brNumericValue]="regexRationalNumber" name="{{tabIndex[colIndex][rowIndex]}}"
                      id="{{tabIndex[colIndex][rowIndex]}}" (ngModelChange)="analyteChanged()"
                      [(ngModel)]="analyteEntry?.levelDataSet[arrIndexFromLevelSummary[colIndex]].data.mean"
                      tabindex="{{tabIndex[colIndex][rowIndex]}}" (focus)="onNewFocus(colIndex);focus(true);"
                      (focusout)="focus(false)" [disabled]="isProductMasterLotExpired || isDisabled" />
                    <mat-hint class="br-text-warn" *ngIf="errorMessage[rowIndex][colIndex]">{{
                      errorMessage[rowIndex][colIndex] }}</mat-hint>
                  </mat-form-field>
                </span>
                <span>
                  <mat-form-field *ngSwitchCase="1" class="small">
                    <input matInput maxlength="16" autocomplete="off" [brNumericValue]="regexRationalNumber"
                      name="{{tabIndex[colIndex][rowIndex]}}" id="{{tabIndex[colIndex][rowIndex]}}"
                      (ngModelChange)="analyteChanged()"
                      [(ngModel)]="analyteEntry?.levelDataSet[arrIndexFromLevelSummary[colIndex]].data.sd"
                      tabindex="{{tabIndex[colIndex][rowIndex]}}" (focus)="onNewFocus(colIndex);focus(true);"
                      (focusout)="focus(false);" [disabled]="isProductMasterLotExpired || isArchived || isDisabled" />
                    <mat-hint class="br-text-warn" *ngIf="errorMessage[rowIndex][colIndex]">{{
                      errorMessage[rowIndex][colIndex] }}</mat-hint>
                  </mat-form-field>
                </span>
                <span>
                  <mat-form-field *ngSwitchCase="2" class="small">
                    <input matInput maxlength="16" autocomplete="off" [brNumericValue]="regexOnlyDigitsGreaterThanZero"
                      name="{{tabIndex[colIndex][rowIndex]}}" id="{{tabIndex[colIndex][rowIndex]}}"
                      (ngModelChange)="analyteChanged()"
                      [(ngModel)]="analyteEntry?.levelDataSet[arrIndexFromLevelSummary[colIndex]].data.numPoints"
                      tabindex="{{tabIndex[colIndex][rowIndex]}}" (focus)="onNewFocus(colIndex);focus(true);"
                      (focusout)="focus(false);" [disabled]="isProductMasterLotExpired || isArchived || isDisabled" />
                    <mat-hint class="br-text-warn" *ngIf="errorMessage[rowIndex][colIndex]">{{
                      errorMessage[rowIndex][colIndex] }}</mat-hint>
                  </mat-form-field>
                </span>
              </div>
            </div>
          </td>
        </ng-container>

        <ng-template #emptyTemplate>
          <div>
            <mat-form-field class="noshow small">
              <input matInput [disabled]="true" placeholder={{ translationLabels.na }}>
            </mat-form-field>
          </div>
        </ng-template>

        <tr mat-row *matRowDef="let myRowData; columns: columnsToDisplay"></tr>
      </table>
      <form [formGroup]="changeLotForm" *ngIf="!isProductMasterLotExpired">
        <br-change-lot formControlName="changeLot" [selectedDate]="today"
          (translationLabelDictionary)="translationLabelDictionary" (ngModelChange)="updateChangeLotData()"
          (editDate)="toggleEditDate($event)" (getLots)="requestLots()" (isLotVisible)="isLotVisible($event)"
          [showOptions]="showOptionsForm" [enableComment]="evaluateCommentField()" [labTestId]="analyteEntry?.labTestId"
          [isSingleSummary]="isSingleSummary" [totalLevels]="(columnsToDisplay | slice:1)" [isDisabled]="isDisabled"
          (requestNewConfig)="requestNewConfiguration($event)">
        </br-change-lot>
      </form>
    </div>
    <div class="item-3">&nbsp;</div>
  </div> <!-- /flex-ctn -->

  <div class="btns-right" [ngClass]="{'mr-10 mb-10': !isSingleEditMode}"
    *ngIf="!isProductMasterLotExpired && isSingleEntry && !isDisabled">
    <button mat-button tabindex="5001" color="primary" id="cancelBtn" (click)="cancel()"
      [disabled]="!isFormVisible && !enableCancel && !isEditMode">{{ translationLabels.cancel }}</button>
    <button mat-raised-button *ngIf="!isEditMode" tabindex="5000" color="primary" class="positive" id="submitBtn"
      (click)="submit()" [disabled]="!enableSubmit"
      matTooltipPosition="above"><em
        class="icon-public mr-5"></em>{{ translationLabels.peergroup }}</button>
    <button mat-raised-button *ngIf="isEditMode" tabindex="5000" color="primary" id="submitBtn" (click)="submit()"
      [disabled]="!enableSubmit"
       matTooltipPosition="above">{{ translationLabels.submit }}</button>
  </div>

</div>
